{% extends 'layouts/base.html.twig' %}

{% block title %}Aviyon - Cart{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-12 bg-gray-900 min-h-screen">
    <!-- Cart Header -->
    <section class="py-12">
        <h1 class="text-4xl font-bold text-purple-400 mb-4">Your Cart</h1>
        <p class="text-xl text-gray-300 mb-8">Review your items and proceed to checkout in the Kodoverse.</p>
    </section>

    <!-- Cart Items -->
    <section class="py-12">
        <div class="grid gap-6 md:grid-cols-3">
            <!-- Cart List -->
            <div class="md:col-span-2">
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl text-purple-400 mb-4">Items in Cart</h2>
                    <div id="cart-items" class="space-y-4">
                        <!-- Item 1 -->
                        <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                            <img src="{{ asset('build/images/nfts/nft1.png') }}" alt="Aether Relic #001" class="w-16 h-16 rounded">
                            <div class="flex-1">
                                <p class="text-gray-300 font-semibold">Aether Relic #001</p>
                                <p class="text-gray-400 text-sm">Added 2 hours ago</p>
                                <div class="flex items-center space-x-2 mt-2">
                                    <button class="quantity-decrease text-gray-400 hover:text-purple-400">-</button>
                                    <span class="quantity text-gray-300">1</span>
                                    <button class="quantity-increase text-gray-400 hover:text-purple-400">+</button>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-300 price">50 AM</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="save-for-later text-gray-400 hover:text-blue-400">Save for Later</button>
                                    <button class="delete-item text-gray-400 hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                            <img src="{{ asset('build/images/virtual-land.jpg') }}" alt="Virtual Land Plot" class="w-16 h-16 rounded">
                            <div class="flex-1">
                                <p class="text-gray-300 font-semibold">Virtual Land Plot</p>
                                <p class="text-gray-400 text-sm">Added 1 day ago</p>
                                <div class="flex items-center space-x-2 mt-2">
                                    <button class="quantity-decrease text-gray-400 hover:text-purple-400">-</button>
                                    <span class="quantity text-gray-300">2</span>
                                    <button class="quantity-increase text-gray-400 hover:text-purple-400">+</button>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-300 price">200 AM</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="save-for-later text-gray-400 hover:text-blue-400">Save for Later</button>
                                    <button class="delete-item text-gray-400 hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                            <img src="{{ asset('build/images/kodoverse-pass.jpg') }}" alt="Kodoverse Pass" class="w-16 h-16 rounded">
                            <div class="flex-1">
                                <p class="text-gray-300 font-semibold">Kodoverse Pass</p>
                                <p class="text-gray-400 text-sm">Added 3 days ago</p>
                                <div class="flex items-center space-x-2 mt-2">
                                    <button class="quantity-decrease text-gray-400 hover:text-purple-400">-</button>
                                    <span class="quantity text-gray-300">1</span>
                                    <button class="quantity-increase text-gray-400 hover:text-purple-400">+</button>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-300 price">100 AM</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="save-for-later text-gray-400 hover:text-blue-400">Save for Later</button>
                                    <button class="delete-item text-gray-400 hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Saved for Later -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg mt-6">
                    <h2 class="text-2xl text-purple-400 mb-4">Saved for Later</h2>
                    <div id="saved-items" class="space-y-4">
                        <!-- Saved Item 1 -->
                        <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                            <img src="{{ asset('build/images/aether-crystal.jpg') }}" alt="Aether Crystal" class="w-16 h-16 rounded">
                            <div class="flex-1">
                                <p class="text-gray-300 font-semibold">Aether Crystal</p>
                                <p class="text-gray-400 text-sm">Saved 5 days ago</p>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-300">75 AM</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="move-to-cart text-gray-400 hover:text-blue-400">Move to Cart</button>
                                    <button class="delete-saved text-gray-400 hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Saved Item 2 -->
                        <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg">
                            <img src="{{ asset('build/images/nimbus-orb.jpg') }}" alt="Nimbus Orb" class="w-16 h-16 rounded">
                            <div class="flex-1">
                                <p class="text-gray-300 font-semibold">Nimbus Orb</p>
                                <p class="text-gray-400 text-sm">Saved 1 week ago</p>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-300">120 AM</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="move-to-cart text-gray-400 hover:text-blue-400">Move to Cart</button>
                                    <button class="delete-saved text-gray-400 hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl text-purple-400 mb-4">Cart Summary</h2>
                <div class="space-y-2">
                    <div class="flex justify-between text-gray-300">
                        <span>Subtotal</span>
                        <span id="cart-subtotal">350 AM</span>
                    </div>
                    <div class="flex justify-between text-gray-300">
                        <span>Tax (5%)</span>
                        <span id="cart-tax">17.50 AM</span>
                    </div>
                    <div class="border-t border-gray-700 pt-2 mt-2">
                        <div class="flex justify-between text-gray-100 font-semibold">
                            <span>Total</span>
                            <span id="cart-total">367.50 AM</span>
                        </div>
                    </div>
                </div>
                <a href="{{ path('checkout') }}" class="block mt-4 text-center bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition">Proceed to Checkout</a>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block javascripts %}
<script>
function updateCartSummary() {
    const prices = Array.from(document.querySelectorAll('#cart-items .price')).map(p => parseFloat(p.textContent));
    const subtotal = prices.reduce((sum, price) => sum + price, 0);
    const tax = subtotal * 0.05;
    const total = subtotal + tax;
    document.getElementById('cart-subtotal').textContent = `${subtotal.toFixed(2)} AM`;
    document.getElementById('cart-tax').textContent = `${tax.toFixed(2)} AM`;
    document.getElementById('cart-total').textContent = `${total.toFixed(2)} AM`;
}

document.querySelectorAll('#cart-items > div').forEach(item => {
    const quantity = item.querySelector('.quantity');
    const price = item.querySelector('.price');
    const basePrice = parseFloat(price.textContent);
    item.querySelector('.quantity-increase').addEventListener('click', () => {
        let count = parseInt(quantity.textContent);
        quantity.textContent = count + 1;
        price.textContent = `${(basePrice * (count + 1)).toFixed(2)} AM`;
        updateCartSummary();
    });
    item.querySelector('.quantity-decrease').addEventListener('click', () => {
        let count = parseInt(quantity.textContent);
        if (count > 1) {
            quantity.textContent = count - 1;
            price.textContent = `${(basePrice * (count - 1)).toFixed(2)} AM`;
            updateCartSummary();
        }
    });
    item.querySelector('.delete-item').addEventListener('click', () => {
        item.remove();
        updateCartSummary();
    });
    item.querySelector('.save-for-later').addEventListener('click', () => {
        const savedItems = document.getElementById('saved-items');
        const clone = item.cloneNode(true);
        clone.querySelector('.save-for-later').remove();
        const moveToCartBtn = document.createElement('button');
        moveToCartBtn.className = 'move-to-cart text-gray-400 hover:text-blue-400';
        moveToCartBtn.textContent = 'Move to Cart';
        clone.querySelector('.flex.space-x-2.mt-2').prepend(moveToCartBtn);
        savedItems.appendChild(clone);
        item.remove();
        updateCartSummary();
        bindSavedItemEvents(clone);
    });
});

function bindSavedItemEvents(item) {
    item.querySelector('.move-to-cart').addEventListener('click', () => {
        const cartItems = document.getElementById('cart-items');
        const clone = item.cloneNode(true);
        clone.querySelector('.move-to-cart').remove();
        const saveForLaterBtn = document.createElement('button');
        saveForLaterBtn.className = 'save-for-later text-gray-400 hover:text-blue-400';
        saveForLaterBtn.textContent = 'Save for Later';
        clone.querySelector('.flex.space-x-2.mt-2').prepend(saveForLaterBtn);
        cartItems.appendChild(clone);
        item.remove();
        updateCartSummary();
        bindCartItemEvents(clone);
    });
    item.querySelector('.delete-saved').addEventListener('click', () => {
        item.remove();
    });
}

function bindCartItemEvents(item) {
    const quantity = item.querySelector('.quantity');
    const price = item.querySelector('.price');
    const basePrice = parseFloat(price.textContent) / parseInt(quantity.textContent);
    item.querySelector('.quantity-increase').addEventListener('click', () => {
        let count = parseInt(quantity.textContent);
        quantity.textContent = count + 1;
        price.textContent = `${(basePrice * (count + 1)).toFixed(2)} AM`;
        updateCartSummary();
    });
    item.querySelector('.quantity-decrease').addEventListener('click', () => {
        let count = parseInt(quantity.textContent);
        if (count > 1) {
            quantity.textContent = count - 1;
            price.textContent = `${(basePrice * (count - 1)).toFixed(2)} AM`;
            updateCartSummary();
        }
    });
    item.querySelector('.delete-item').addEventListener('click', () => {
        item.remove();
        updateCartSummary();
    });
    item.querySelector('.save-for-later').addEventListener('click', () => {
        const savedItems = document.getElementById('saved-items');
        const clone = item.cloneNode(true);
        clone.querySelector('.save-for-later').remove();
        const moveToCartBtn = document.createElement('button');
        moveToCartBtn.className = 'move-to-cart text-gray-400 hover:text-blue-400';
        moveToCartBtn.textContent = 'Move to Cart';
        clone.querySelector('.flex.space-x-2.mt-2').prepend(moveToCartBtn);
        savedItems.appendChild(clone);
        item.remove();
        updateCartSummary();
        bindSavedItemEvents(clone);
    });
}

document.querySelectorAll('#saved-items > div').forEach(item => bindSavedItemEvents(item));
</script>
{% endblock %}
